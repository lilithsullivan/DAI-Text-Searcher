<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DAI Localization Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --primary: #1e293b; --accent: #3b82f6; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: "Segoe UI", system-ui, sans-serif; margin: 0; background: var(--bg); color: #334155; }
        
        header { background: var(--primary); color: white; padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; gap: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .logo { font-weight: bold; font-size: 1.2rem; min-width: 150px; }
        .search-input { flex: 1; padding: 10px 20px; border-radius: 8px; border: none; font-size: 16px; outline: none; }
        
        main { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .stats { font-size: 12px; color: #64748b; margin-bottom: 10px; }
        
        .card { background: var(--card); border-radius: 8px; padding: 15px; margin-bottom: 12px; border: 1px solid #e2e8f0; transition: transform 0.1s; cursor: pointer; }
        .card:hover { border-color: var(--accent); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; margin-bottom: 10px; }
        .id-badge { background: #f1f5f9; padding: 2px 8px; border-radius: 4px; font-family: monospace; font-size: 13px; color: var(--accent); }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .lang-label { font-size: 10px; font-weight: bold; color: #94a3b8; text-transform: uppercase; margin-bottom: 4px; }
        .content { font-size: 14px; line-height: 1.5; white-space: pre-wrap; }
        
        /* 模态框 - 上下文查看 */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 1000px; max-height: 80vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .modal-header { padding: 15px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; }
        .modal-body { overflow-y: auto; padding: 20px; flex: 1; }
        .ctx-item { padding: 10px; border-bottom: 1px solid #f1f5f9; border-radius: 4px; }
        .ctx-item.active { background: #eff6ff; border: 1px solid var(--accent); }
        .close-btn { cursor: pointer; font-size: 24px; line-height: 1; }

        /* 搜索关键词高亮样式 */
        .highlight {
        background-color: #ffeb3b; /* 亮黄色背景 */
        color: #000;
        padding: 0 2px;
        border-radius: 2px;
        font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="logo">DAI Strings Explorer</div>
            <input type="text" v-model="searchText" class="search-input" placeholder="输入关键词或 ID 搜索...">
        </header>

        <main v-if="loading">正在加载语料库 (dai_corpus.csv)...</main>
        
        <main v-else>
            <div class="stats">共记录: {{allData.length}} 条 | 搜索结果: {{filteredData.length}} 条</div>
            
            <div v-for="item in filteredData" :key="item.ID" class="card" @click="showContext(item.ID)">
                <div class="card-header">
                    <span class="id-badge">ID: {{item.ID}}</span>
                    <span style="font-size:12px; color:#94a3b8;">点击查看上下文</span>
                </div>
                <div class="grid">
                    <div><div class="lang-label">English</div><div class="content">{{item.English}}</div></div>
                    <div><div class="lang-label">简体中文</div><div class="content">{{item['Simplified Chinese']}}</div></div>
                    <div><div class="lang-label">繁體中文</div><div class="content">{{item['Traditional Chinese']}}</div></div>
                </div>
            </div>
        </main>

        <div class="modal" v-if="contextID" @click.self="contextID = null">
            <div class="modal-content">
                <div class="modal-header">
                    <b>上下文查看 (ID: {{contextID}} 前后行)</b>
                    <span class="close-btn" @click="contextID = null">&times;</span>
                </div>
                <div class="modal-body">
                    <div v-for="ctx in contextList" :class="['ctx-item', ctx.ID === contextID ? 'active' : '']">
                        <div class="id-badge" style="margin-bottom:5px;">ID: {{ctx.ID}}</div>
                        <div class="grid">
                            <div class="content">{{ctx.English}}</div>
                            <div class="content">{{ctx['Simplified Chinese']}}</div>
                            <div class="content">{{ctx['Traditional Chinese']}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        createApp({
            setup() {
                const allData = ref([]);
                const searchText = ref("");
                const loading = ref(true);
                const contextID = ref(null);

                onMounted(() => {
                    // 使用 PapaParse 直接读取本地 CSV
                    Papa.parse("dai_corpus.csv", {
                        download: true,
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            allData.value = results.data;
                            loading.value = false;
                        }
                    });
                });

                const filteredData = computed(() => {
                    if (!searchText.value) return allData.value.slice(0, 50);
                    const q = searchText.value.toLowerCase();
                    return allData.value.filter(i => 
                        (i.ID && i.ID.includes(q)) ||
                        (i.English && i.English.toLowerCase().includes(q)) ||
                        (i['Simplified Chinese'] && i['Simplified Chinese'].includes(q))
                    ).slice(0, 100); // 限制100条保证性能
                });

                const showContext = (id) => {
                    contextID.value = id;
                };

                const contextList = computed(() => {
                    if (!contextID.value) return [];
                    const idx = allData.value.findIndex(i => i.ID === contextID.value);
                    return allData.value.slice(Math.max(0, idx - 5), idx + 6);
                });

                return { allData, searchText, loading, filteredData, contextID, showContext, contextList };
            }
        }).mount('#app');
    </script>
</body>
</html>