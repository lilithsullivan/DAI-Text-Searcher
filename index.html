<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DAI Localization Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --primary: #1e293b; --accent: #3b82f6; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: "Segoe UI", system-ui, sans-serif; margin: 0; background: var(--bg); color: #334155; }
        
        header { background: var(--primary); color: white; padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; gap: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .logo { font-weight: bold; font-size: 1.2rem; min-width: 150px; }
        .search-input { flex: 1; padding: 10px 20px; border-radius: 8px; border: none; font-size: 16px; outline: none; color: #334155; }
        
        main { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .stats { font-size: 12px; color: #64748b; margin-bottom: 10px; }
        
        .card { background: var(--card); border-radius: 8px; padding: 15px; margin-bottom: 12px; border: 1px solid #e2e8f0; transition: all 0.2s; cursor: pointer; }
        .card:hover { border-color: var(--accent); box-shadow: 0 4px 12px rgba(0,0,0,0.05); background: #fcfdfe; }
        .card-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; margin-bottom: 10px; }
        .id-badge { background: #f1f5f9; padding: 2px 8px; border-radius: 4px; font-family: monospace; font-size: 13px; color: var(--accent); font-weight: bold; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .lang-label { font-size: 10px; font-weight: bold; color: #94a3b8; text-transform: uppercase; margin-bottom: 4px; }
        .content { font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-break: break-word; }
        
        /* 搜索关键词高亮样式 */
        .highlight {
            background-color: #ffeb3b;
            color: #000;
            padding: 0 2px;
            border-radius: 2px;
            font-weight: bold;
        }

        /* 模态框 - 上下文查看 */
        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 100%; max-width: 1100px; max-height: 85vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
        .modal-header { padding: 15px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { overflow-y: auto; padding: 20px; flex: 1; background: #f1f5f9; }
        .ctx-item { padding: 15px; background: white; margin-bottom: 10px; border: 1px solid #e2e8f0; border-radius: 8px; transition: transform 0.1s; }
        .ctx-item.active { border: 2px solid var(--accent); background: #eff6ff; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .close-btn { cursor: pointer; font-size: 28px; color: #64748b; line-height: 1; transition: color 0.2s; }
        .close-btn:hover { color: #ef4444; }

        footer { text-align: center; padding: 2rem; color: #94a3b8; font-size: 12px; border-top: 1px solid #e2e8f0; margin-top: 2rem; }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="logo">DAI Strings Explorer</div>
            <input type="text" v-model="searchText" class="search-input" placeholder="输入关键词 (如 'Fade') 或 ID 搜索..." @keyup.esc="searchText = ''">
        </header>

        <main v-if="loading" style="text-align: center; padding-top: 100px;">
            <div style="font-size: 24px; margin-bottom: 10px;">⌛</div>
            正在加载语料库 (dai_corpus.csv)...
        </main>
        
        <main v-else>
            <div class="stats">
                共记录: <b>{{allData.length.toLocaleString()}}</b> 条 | 
                <span v-if="searchText">搜索结果: <b>{{filteredData.length}}</b> 条</span>
                <span v-else>正在显示前 50 条记录</span>
            </div>
            
            <div v-for="item in filteredData" :key="item.ID" class="card" @click="showContext(item.ID)">
                <div class="card-header">
                    <span class="id-badge">ID: {{item.ID}}</span>
                    <span style="font-size:12px; color:var(--accent); font-weight: 500;">查看上下文 &rarr;</span>
                </div>
                <div class="grid">
                    <div>
                        <div class="lang-label">English</div>
                        <div class="content" v-html="highlightText(item.English)"></div>
                    </div>
                    <div>
                        <div class="lang-label">简体中文</div>
                        <div class="content" v-html="highlightText(item['Simplified Chinese'])"></div>
                    </div>
                    <div>
                        <div class="lang-label">繁體中文</div>
                        <div class="content" v-html="highlightText(item['Traditional Chinese'])"></div>
                    </div>
                </div>
            </div>

            <div v-if="filteredData.length === 0" style="text-align: center; padding: 50px; color: #94a3b8;">
                没有找到匹配的文本
            </div>
        </main>

        <div class="modal" v-if="contextID" @click.self="contextID = null">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <b>剧情上下文查看</b>
                        <span class="id-badge">定位 ID: {{contextID}}</span>
                    </div>
                    <span class="close-btn" @click="contextID = null">&times;</span>
                </div>
                <div class="modal-body">
                    <div v-for="ctx in contextList" :key="ctx.ID" :class="['ctx-item', ctx.ID === contextID ? 'active' : '']">
                        <div style="margin-bottom: 8px; display: flex; justify-content: space-between;">
                            <span class="id-badge" style="background: #e2e8f0; color: #475569;">ID: {{ctx.ID}}</span>
                            <span v-if="ctx.ID === contextID" style="font-size: 11px; color: var(--accent); font-weight: bold;">当前条目</span>
                        </div>
                        <div class="grid">
                            <div><div class="content" v-html="highlightText(ctx.English)"></div></div>
                            <div><div class="content" v-html="highlightText(ctx['Simplified Chinese'])"></div></div>
                            <div><div class="content" v-html="highlightText(ctx['Traditional Chinese'])"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            本工具仅供汉化本地化学术研究使用。游戏版权归 BioWare / Electronic Arts 所有。
        </footer>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        createApp({
            setup() {
                const allData = ref([]);
                const searchText = ref("");
                const loading = ref(true);
                const contextID = ref(null);

                onMounted(() => {
                    Papa.parse("dai_corpus.csv", {
                        download: true,
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            allData.value = results.data;
                            loading.value = false;
                        }
                    });
                });

                // 搜索结果逻辑
                const filteredData = computed(() => {
                    if (!searchText.value) return allData.value.slice(0, 50);
                    const q = searchText.value.toLowerCase();
                    return allData.value.filter(i => 
                        (i.ID && i.ID.includes(q)) ||
                        (i.English && i.English.toLowerCase().includes(q)) ||
                        (i['Simplified Chinese'] && i['Simplified Chinese'].includes(q)) ||
                        (i['Traditional Chinese'] && i['Traditional Chinese'].includes(q))
                    ).slice(0, 100); 
                });

                // 高亮逻辑函数
                const highlightText = (text) => {
                    if (!searchText.value || !text) return text;
                    // 转义正则特殊符号
                    const escapedSearch = searchText.value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`(${escapedSearch})`, 'gi');
                    return text.toString().replace(regex, '<span class="highlight">$1</span>');
                };

                const showContext = (id) => {
                    contextID.value = id;
                };

                // 获取上下文（前后各5条）
                const contextList = computed(() => {
                    if (!contextID.value) return [];
                    const idx = allData.value.findIndex(i => i.ID === contextID.value);
                    if (idx === -1) return [];
                    return allData.value.slice(Math.max(0, idx - 5), idx + 6);
                });

                return { 
                    allData, 
                    searchText, 
                    loading, 
                    filteredData, 
                    contextID, 
                    showContext, 
                    contextList,
                    highlightText 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>